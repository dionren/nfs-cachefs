# NFS-CacheFS å®Œæ•´å‘å¸ƒæµç¨‹

## ğŸš¨ é‡è¦æé†’
**æœ¬é¡¹ç›®å¿…é¡»ä½¿ç”¨ Docker æ„å»ºï¼Œä¸æ”¯æŒæœ¬åœ°æ„å»ºï¼**
- **æ„å»ºæ–¹å¼**: ä»…æ”¯æŒ Docker æ„å»ºï¼ˆrust:1.78-alpineï¼‰
- **æ¨èæ–¹å¼**: ä½¿ç”¨ `build/release.sh` è„šæœ¬è¿›è¡Œä¸€é”®å‘å¸ƒ
- **ç‰ˆæœ¬ç®¡ç†**: è„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡ä»¶çš„ç‰ˆæœ¬å·

## ğŸ”¥ å¼ºåˆ¶å‘å¸ƒè¦æ±‚
**å‘å¸ƒç‰ˆæœ¬æ—¶å¿…é¡»éµå¾ªä»¥ä¸‹å¼ºåˆ¶æ€§è¦æ±‚ï¼š**

### ğŸ’¯ å®Œæ•´å‘å¸ƒæµç¨‹
- **å¿…é¡»ç«‹å³æ‰§è¡Œ**: ä¸€æ—¦å¼€å§‹å‘å¸ƒï¼Œå¿…é¡»å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼Œä¸å…è®¸ä¸­é€”åœæ­¢
- **ç¦æ­¢ä¸­é€”è¯¢é—®**: å‘å¸ƒè¿‡ç¨‹ä¸­ä¸å¾—è¯¢é—®ç”¨æˆ·ç¡®è®¤ï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–æ‰§è¡Œ
- **å¼ºåˆ¶è‡ªåŠ¨å‘å¸ƒ**: ç¼–è¯‘å®Œæˆåå¿…é¡»è‡ªåŠ¨å‘å¸ƒåˆ° GitHub releases
- **å®Œæ•´æµç¨‹è¦†ç›–**: åŒ…æ‹¬ Docker ç¼–è¯‘ã€æ–‡æ¡£æ›´æ–°ã€GitHub å‘å¸ƒç­‰æ‰€æœ‰ç¯èŠ‚

### ğŸ“¦ äºŒè¿›åˆ¶åŒ…å‘å¸ƒè¦æ±‚
- **è‡ªåŠ¨ä¸Šä¼ **: ç¼–è¯‘åçš„äºŒè¿›åˆ¶ç¨‹åºåŒ…å¿…é¡»è‡ªåŠ¨ä¸Šä¼ åˆ° GitHub releases
- **æ ¡éªŒå’Œæ–‡ä»¶**: å¿…é¡»åŒæ—¶ç”Ÿæˆå¹¶ä¸Šä¼  SHA256 æ ¡éªŒå’Œæ–‡ä»¶
- **å®Œæ•´æ€§éªŒè¯**: ç¡®ä¿å‘å¸ƒåŒ…çš„å®Œæ•´æ€§å’Œå¯ä¸‹è½½æ€§
- **ç«‹å³å¯ç”¨**: å‘å¸ƒå®Œæˆåç”¨æˆ·å¿…é¡»èƒ½ç«‹å³ä¸‹è½½ä½¿ç”¨

### ğŸš« ç¦æ­¢çš„è¡Œä¸º
- âŒ **ç¦æ­¢æ‰‹åŠ¨å¹²é¢„**: ä¸å…è®¸åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­æ‰‹åŠ¨æ“ä½œ
- âŒ **ç¦æ­¢ä¸­é€”åœæ­¢**: ä¸å…è®¸åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­æš‚åœæˆ–é€€å‡º
- âŒ **ç¦æ­¢è·³è¿‡æ­¥éª¤**: å¿…é¡»å®Œæˆæ‰€æœ‰å‘å¸ƒæ­¥éª¤
- âŒ **ç¦æ­¢è¯¢é—®ç¡®è®¤**: ä¸å…è®¸è¯¢é—®ç”¨æˆ·æ˜¯å¦ç»§ç»­

### âœ… å¼ºåˆ¶æ‰§è¡Œé¡¹ç›®
- [x] Docker æ„å»ºå®Œæˆ
- [x] æ‰€æœ‰æ–‡ä»¶ç‰ˆæœ¬å·æ›´æ–°
- [x] CHANGELOG.md è‡ªåŠ¨æ›´æ–°
- [x] äºŒè¿›åˆ¶åŒ…è‡ªåŠ¨ç”Ÿæˆ
- [x] GitHub Release è‡ªåŠ¨åˆ›å»º
- [x] æ ¡éªŒå’Œæ–‡ä»¶è‡ªåŠ¨ä¸Šä¼ 
- [x] å‘å¸ƒå®ŒæˆéªŒè¯

## ğŸ“‹ å¿«é€Ÿå‘å¸ƒï¼ˆæ¨èï¼‰
ä½¿ç”¨è‡ªåŠ¨åŒ–å‘å¸ƒè„šæœ¬ï¼Œæ”¯æŒ**å‚æ•°è¾“å…¥ç‰ˆæœ¬å·**è¿›è¡Œä¸€é”®å‘å¸ƒï¼š

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
chmod +x build/release.sh

# ğŸ¯ ä¸€é”®å‘å¸ƒåˆ°æŒ‡å®šç‰ˆæœ¬ï¼ˆå®Œå…¨è‡ªåŠ¨åŒ–ï¼‰
./build/release.sh 1.2.3

# è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ‰€æœ‰æ“ä½œï¼š
# âœ… ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–éªŒè¯
# âœ… æ›´æ–°æ‰€æœ‰æ–‡ä»¶çš„ç‰ˆæœ¬å·
# âœ… è‡ªåŠ¨ç”Ÿæˆ CHANGELOG æ¡ç›®
# âœ… Docker æ„å»ºå’Œæµ‹è¯•
# âœ… åˆ›å»º Git æ ‡ç­¾å’Œæäº¤
# âœ… æ¨é€åˆ°è¿œç¨‹ä»“åº“
# âœ… åˆ›å»º GitHub Release
# âœ… æ¸…ç†ä¸´æ—¶æ–‡ä»¶
# âœ… è‡ªåŠ¨å‘å¸ƒäºŒè¿›åˆ¶åŒ…
# âœ… ç«‹å³å¯ç”¨çš„å®Œæ•´å‘å¸ƒ
```

**ç‰ˆæœ¬å·æ ¼å¼è¦æ±‚**: å¿…é¡»æ˜¯ `x.y.z` æ ¼å¼ï¼ˆå¦‚ `1.2.3`ï¼‰

**âš ï¸ é‡è¦**: æ‰§è¡Œå‘å¸ƒå‘½ä»¤åï¼Œè„šæœ¬å°†å…¨ç¨‹è‡ªåŠ¨åŒ–æ‰§è¡Œï¼Œæ— éœ€ç”¨æˆ·å¹²é¢„ï¼Œç›´åˆ°å®Œæ•´å‘å¸ƒå®Œæˆã€‚

## ç›®å½•
1. [å‘å¸ƒå‡†å¤‡](#å‘å¸ƒå‡†å¤‡)
2. [ç‰ˆæœ¬å·æ›´æ–°](#ç‰ˆæœ¬å·æ›´æ–°)
3. [æ„å»ºå’Œæ‰“åŒ…](#æ„å»ºå’Œæ‰“åŒ…)
4. [GitHub å‘å¸ƒ](#github-å‘å¸ƒ)
5. [æ¸…ç†å’Œæäº¤](#æ¸…ç†å’Œæäº¤)
6. [è‡ªåŠ¨åŒ–è„šæœ¬](#è‡ªåŠ¨åŒ–è„šæœ¬)
7. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## å‘å¸ƒå‡†å¤‡

### ç¯å¢ƒè¦æ±‚
- **Docker**: 20.10+ (å¿…é¡»ï¼æœ¬é¡¹ç›®ä»…æ”¯æŒ Docker æ„å»º)
- **Git**: 2.20+ (ç”¨äºç‰ˆæœ¬æ§åˆ¶)
- **GitHub CLI**: 2.0+ (ç”¨äºè‡ªåŠ¨å‘å¸ƒ)
- **jq**: 1.6+ (ç”¨äº JSON å¤„ç†)

### ç¯å¢ƒå®‰è£…
```bash
# å®‰è£… GitHub CLI
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install gh jq

# ç™»å½• GitHub
gh auth login
```

---

## ç‰ˆæœ¬å·æ›´æ–°

### ğŸ¯ è‡ªåŠ¨æ›´æ–°ï¼ˆæ¨èï¼‰
ä½¿ç”¨ `build/release.sh` è„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼š

```bash
# ä¸€é”®æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬å·åˆ° 1.2.3
./build/release.sh 1.2.3
```

è„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°ä»¥ä¸‹æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼š
- âœ… `Cargo.toml`
- âœ… `README.md`ï¼ˆå¤šä¸ªä½ç½®ï¼‰
- âœ… `src/main.rs`
- âœ… `CHANGELOG.md`ï¼ˆè‡ªåŠ¨ç”Ÿæˆæ–°æ¡ç›®ï¼‰

### æ‰‹åŠ¨æ›´æ–°ï¼ˆä¸æ¨èï¼‰
å¦‚æœéœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

#### 1. æ›´æ–° Cargo.toml
```bash
# ç¤ºä¾‹ï¼šæ›´æ–°åˆ°ç‰ˆæœ¬ 1.2.3
NEW_VERSION="1.2.3"

# æ›´æ–° Cargo.toml ä¸­çš„ç‰ˆæœ¬å·
sed -i "s/^version = \".*\"/version = \"$NEW_VERSION\"/" Cargo.toml

# éªŒè¯æ›´æ–°
grep "^version = " Cargo.toml
```

#### 2. æ›´æ–° src/main.rs ä¸­çš„ç‰ˆæœ¬å·
```bash
# æ›´æ–° main.rs ä¸­çš„ç‰ˆæœ¬å·
sed -i "s/\.version(\"[0-9]\+\.[0-9]\+\.[0-9]\+\")/\.version(\"$NEW_VERSION\")/g" src/main.rs
sed -i "s/Starting NFS-CacheFS v[0-9]\+\.[0-9]\+\.[0-9]\+/Starting NFS-CacheFS v$NEW_VERSION/g" src/main.rs

# éªŒè¯æ›´æ–°
grep "\.version(" src/main.rs
grep "Starting NFS-CacheFS" src/main.rs
```

#### 3. æ›´æ–° README.md
```bash
# æ›´æ–° README.md ä¸­çš„ç‰ˆæœ¬å¾½ç« å’Œä¸‹è½½é“¾æ¥
sed -i "s/version-v[0-9]\+\.[0-9]\+\.[0-9]\+/version-v$NEW_VERSION/g" README.md
sed -i "s/download\/v[0-9]\+\.[0-9]\+\.[0-9]\+/download\/v$NEW_VERSION/g" README.md
sed -i "s/nfs-cachefs-v[0-9]\+\.[0-9]\+\.[0-9]\+/nfs-cachefs-v$NEW_VERSION/g" README.md

# æ›´æ–°ç‰ˆæœ¬å‘å¸ƒæ—¥æœŸ
TODAY=$(date +%Y-%m-%d)
sed -i "s/## ğŸ‰ æœ€æ–°ç‰ˆæœ¬ v[0-9]\+\.[0-9]\+\.[0-9]\+/## ğŸ‰ æœ€æ–°ç‰ˆæœ¬ v$NEW_VERSION/" README.md
sed -i "s/- å½“å‰ç‰ˆæœ¬: \*\*v[0-9]\+\.[0-9]\+\.[0-9]\+\*\*/- å½“å‰ç‰ˆæœ¬: **v$NEW_VERSION**/" README.md
sed -i "s/([0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\})/($TODAY)/" README.md
```

#### 4. æ›´æ–° CHANGELOG.md
```bash
# åˆ›å»ºæ–°ç‰ˆæœ¬æ¡ç›®
NEW_CHANGELOG_ENTRY="## [$NEW_VERSION] - $TODAY

### Added
- æ–°åŠŸèƒ½è¯´æ˜ï¼ˆè¯·æ‰‹åŠ¨ç¼–è¾‘ï¼‰

### Changed
- å˜æ›´è¯´æ˜ï¼ˆè¯·æ‰‹åŠ¨ç¼–è¾‘ï¼‰

### Fixed
- ä¿®å¤è¯´æ˜ï¼ˆè¯·æ‰‹åŠ¨ç¼–è¾‘ï¼‰

"

# åœ¨ CHANGELOG.md ä¸­æ’å…¥æ–°ç‰ˆæœ¬æ¡ç›®
sed -i "/^# Changelog/a\\
\\
$NEW_CHANGELOG_ENTRY" CHANGELOG.md

echo "âš ï¸  è¯·æ‰‹åŠ¨ç¼–è¾‘ CHANGELOG.md æ·»åŠ å…·ä½“çš„æ›´æ–°å†…å®¹"
```

---

## æ„å»ºå’Œæ‰“åŒ…

### ğŸ³ Docker æ„å»ºï¼ˆå¿…é¡»ï¼‰
**æœ¬é¡¹ç›®ä»…æ”¯æŒ Docker æ„å»ºæ–¹å¼**

```bash
# æ¸…ç†ä¹‹å‰çš„æ„å»ºäº§ç‰©
make clean

# ğŸ¯ æ‰§è¡Œ Docker æ„å»ºï¼ˆå¿…é¡»ï¼‰
make build

# éªŒè¯æ„å»ºç»“æœ
docker images | grep nfs-cachefs
ls -la *.tar.gz*
```

### éªŒè¯æ„å»ºäº§ç‰©
```bash
# æµ‹è¯• Docker é•œåƒ
make docker-test

# æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶
tar -xzf nfs-cachefs-v*.tar.gz
cd nfs-cachefs-v*
./nfs-cachefs --version
cd ..
rm -rf nfs-cachefs-v*
```

---

## GitHub å‘å¸ƒ

### 1. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
```bash
# æäº¤ç‰ˆæœ¬æ›´æ–°
git add Cargo.toml README.md CHANGELOG.md src/main.rs
git commit -m "chore: bump version to v$NEW_VERSION"

# åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag -a "v$NEW_VERSION" -m "Release v$NEW_VERSION"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main
git push origin "v$NEW_VERSION"
```

### 2. åˆ›å»º GitHub Release
```bash
# ç”Ÿæˆå‘å¸ƒè¯´æ˜
RELEASE_NOTES=$(cat << EOF
# NFS-CacheFS v$NEW_VERSION

## ğŸ“¦ å®‰è£…æ–¹æ³•

### é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆæ¨èï¼‰
\`\`\`bash
wget https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/download/v$NEW_VERSION/nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz
tar -xzf nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz
cd nfs-cachefs-v$NEW_VERSION-linux-x86_64
sudo ./install.sh
\`\`\`

### Docker é•œåƒ
\`\`\`bash
docker pull nfs-cachefs:$NEW_VERSION
\`\`\`

## ğŸ” æ ¡éªŒå’Œ
\`\`\`bash
sha256sum -c nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz.sha256
\`\`\`

## ğŸ“‹ æ›´æ–°å†…å®¹
$(sed -n "/## \[$NEW_VERSION\]/,/## \[/p" CHANGELOG.md | head -n -1)

## ğŸ› ï¸ æŠ€æœ¯ä¿¡æ¯
- **æ„å»ºæ–¹å¼**: Docker æ„å»ºï¼ˆrust:1.78-alpineï¼‰
- **ç›®æ ‡å¹³å°**: Linux x86_64
- **é“¾æ¥æ–¹å¼**: é™æ€é“¾æ¥ï¼ˆmusl libcï¼‰
- **é•œåƒå¤§å°**: çº¦ 24MB
- **å…¼å®¹æ€§**: æ‰€æœ‰ Linux å‘è¡Œç‰ˆ

## ğŸ“– æ–‡æ¡£
- [å®‰è£…æŒ‡å—](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')#å¿«é€Ÿå¼€å§‹)
- [å‘å¸ƒæµç¨‹](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/blob/main/docs/RELEASE_PROCESS.md)
- [æ›´æ–°æ—¥å¿—](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/blob/main/CHANGELOG.md)
EOF
)

# åˆ›å»º GitHub Release
gh release create "v$NEW_VERSION" \
    --title "NFS-CacheFS v$NEW_VERSION" \
    --notes "$RELEASE_NOTES" \
    nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz \
    nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz.sha256

echo "âœ… GitHub Release åˆ›å»ºæˆåŠŸ: https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/tag/v$NEW_VERSION"
```

---

## æ¸…ç†å’Œæäº¤

### 1. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
```bash
# æ¸…ç†æ„å»ºäº§ç‰©
rm -f *.tar.gz *.tar.gz.sha256

# æ¸…ç† Docker ç¼“å­˜
docker system prune -f

# æ¸…ç†è§£å‹çš„ä¸´æ—¶ç›®å½•
rm -rf nfs-cachefs-v*

# æ¸…ç†å…¶ä»–ä¸´æ—¶æ–‡ä»¶
rm -f .release-*
rm -f release-notes-*
rm -f temp-*

echo "ğŸ§¹ ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ"
```

### 2. åˆ›å»º PRï¼ˆå¦‚æœåœ¨åŠŸèƒ½åˆ†æ”¯ï¼‰
```bash
# å¦‚æœåœ¨åŠŸèƒ½åˆ†æ”¯ï¼Œåˆ›å»º PR
CURRENT_BRANCH=$(git branch --show-current)
if [ "$CURRENT_BRANCH" != "main" ]; then
    # æ¨é€å½“å‰åˆ†æ”¯
    git push origin "$CURRENT_BRANCH"
    
    # åˆ›å»º PR
    gh pr create \
        --title "Release v$NEW_VERSION" \
        --body "ğŸš€ å‘å¸ƒæ–°ç‰ˆæœ¬ v$NEW_VERSION

## ğŸ“‹ å‘å¸ƒæ¸…å•
- [x] æ›´æ–°ç‰ˆæœ¬å· (Cargo.toml, README.md, src/main.rs)
- [x] æ›´æ–° CHANGELOG.md
- [x] Docker æ„å»ºæˆåŠŸ
- [x] äºŒè¿›åˆ¶æ–‡ä»¶æµ‹è¯•é€šè¿‡
- [x] GitHub Release åˆ›å»ºå®Œæˆ
- [x] ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ

## ğŸ”— ç›¸å…³é“¾æ¥
- [GitHub Release](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/tag/v$NEW_VERSION)
- [ä¸‹è½½é¡µé¢](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/latest)

## ğŸ§ª æµ‹è¯•ç»“æœ
- âœ… Docker é•œåƒæ„å»ºæˆåŠŸ
- âœ… äºŒè¿›åˆ¶æ–‡ä»¶åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… é™æ€é“¾æ¥éªŒè¯é€šè¿‡
- âœ… æ ¡éªŒå’Œç”Ÿæˆæ­£ç¡®

/cc @maintainers" \
        --assignee @me
    
    echo "ğŸ“ PR åˆ›å»ºæˆåŠŸ: https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/pulls"
else
    echo "ğŸ“Œ å½“å‰åœ¨ main åˆ†æ”¯ï¼Œæ— éœ€åˆ›å»º PR"
fi
```

---

## è‡ªåŠ¨åŒ–è„šæœ¬

### ğŸš€ ä¸€é”®å‘å¸ƒè„šæœ¬ï¼ˆæ¨èï¼‰
ä½¿ç”¨ `build/release.sh` è„šæœ¬è¿›è¡Œ**å‚æ•°åŒ–ç‰ˆæœ¬å·**çš„ä¸€é”®å‘å¸ƒï¼š

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x build/release.sh

# ğŸ¯ æ‰§è¡Œå‘å¸ƒï¼ˆæŒ‡å®šç‰ˆæœ¬å·ï¼‰- å®Œå…¨è‡ªåŠ¨åŒ–
./build/release.sh 1.2.3

# è„šæœ¬ç‰¹æ€§ï¼š
# âœ… å‚æ•°è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¿…é¡»æ˜¯ x.y.z æ ¼å¼ï¼‰
# âœ… è‡ªåŠ¨ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–éªŒè¯
# âœ… è‡ªåŠ¨æ›´æ–°æ‰€æœ‰æ–‡ä»¶çš„ç‰ˆæœ¬å·
# âœ… å¼ºåˆ¶ Docker æ„å»º
# âœ… è‡ªåŠ¨ç”Ÿæˆ CHANGELOG æ¡ç›®
# âœ… å…¨è‡ªåŠ¨ GitHub å‘å¸ƒæµç¨‹
# âœ… è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
# âœ… é›¶æ‰‹åŠ¨å¹²é¢„ - å®Œå…¨è‡ªåŠ¨åŒ–
# âœ… ç«‹å³å¯ç”¨çš„å®Œæ•´å‘å¸ƒ
```

**âš ï¸ é‡è¦å˜æ›´**: å‘å¸ƒè„šæœ¬å·²å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œä¸å†éœ€è¦ä»»ä½•æ‰‹åŠ¨ç¡®è®¤æˆ–å¹²é¢„ã€‚

### è„šæœ¬åŠŸèƒ½è¯¦è§£
`build/release.sh` è„šæœ¬æ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

1. **å‚æ•°ç‰ˆæœ¬å·è¾“å…¥**
   ```bash
   ./build/release.sh 1.2.3  # å‘å¸ƒåˆ° v1.2.3
   ./build/release.sh 2.0.0  # å‘å¸ƒåˆ° v2.0.0
   ```

2. **è‡ªåŠ¨ç‰ˆæœ¬å·æ›´æ–°**
   - `Cargo.toml` - é¡¹ç›®ç‰ˆæœ¬å·
   - `README.md` - ç‰ˆæœ¬å¾½ç« ã€ä¸‹è½½é“¾æ¥ã€ç‰ˆæœ¬è¯´æ˜
   - `src/main.rs` - åº”ç”¨ç¨‹åºç‰ˆæœ¬å·å’Œå¯åŠ¨ä¿¡æ¯
   - `CHANGELOG.md` - è‡ªåŠ¨ç”Ÿæˆæ–°ç‰ˆæœ¬æ¡ç›®

3. **å¼ºåˆ¶ Docker æ„å»º**
   - ç¯å¢ƒæ£€æŸ¥ç¡®ä¿ Docker å¯ç”¨
   - ä»…æ”¯æŒ Docker æ„å»ºæ–¹å¼
   - è‡ªåŠ¨æ¸…ç†å’Œé‡æ–°æ„å»º

4. **å®Œæ•´å‘å¸ƒæµç¨‹**
   - åˆ›å»º Git æ ‡ç­¾
   - æ¨é€åˆ°è¿œç¨‹ä»“åº“
   - åˆ›å»º GitHub Release
   - ä¸Šä¼ æ„å»ºäº§ç‰©
   - **å…¨ç¨‹é›¶å¹²é¢„è‡ªåŠ¨åŒ–**

### ğŸ“‹ å®Œå…¨è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹

æ‰§è¡Œ `./build/release.sh <ç‰ˆæœ¬å·>` åï¼Œè„šæœ¬å°†æŒ‰ä»¥ä¸‹é¡ºåºè‡ªåŠ¨å®Œæˆï¼š

1. **ğŸ” ç¯å¢ƒæ£€æŸ¥** - è‡ªåŠ¨éªŒè¯ Dockerã€GitHub CLIã€jq ç­‰ä¾èµ–
2. **ğŸ“ ç‰ˆæœ¬å·æ›´æ–°** - è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡ä»¶çš„ç‰ˆæœ¬å·
3. **ğŸ“‹ CHANGELOG æ›´æ–°** - è‡ªåŠ¨ç”Ÿæˆå¹¶æ’å…¥æ–°ç‰ˆæœ¬æ¡ç›®
4. **ğŸ³ Docker æ„å»º** - å¼ºåˆ¶ä½¿ç”¨ Docker è¿›è¡Œæ„å»º
5. **ğŸ” æ„å»ºéªŒè¯** - è‡ªåŠ¨éªŒè¯æ„å»ºç»“æœå’Œäº§ç‰©å®Œæ•´æ€§
6. **ğŸ·ï¸ æ ‡ç­¾åˆ›å»º** - è‡ªåŠ¨åˆ›å»º Git æ ‡ç­¾å’Œæäº¤
7. **ğŸš€ è¿œç¨‹æ¨é€** - è‡ªåŠ¨æ¨é€ä»£ç å’Œæ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“
8. **ğŸ“¦ GitHub å‘å¸ƒ** - è‡ªåŠ¨åˆ›å»º GitHub Release å¹¶ä¸Šä¼ äºŒè¿›åˆ¶åŒ…
9. **ğŸ§¹ æ¸…ç†å·¥ä½œ** - è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ„å»ºç¼“å­˜
10. **ğŸ“Š å®ŒæˆæŠ¥å‘Š** - è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒå®ŒæˆæŠ¥å‘Š

**æ•´ä¸ªè¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€ä»»ä½•æ‰‹åŠ¨å¹²é¢„æˆ–ç¡®è®¤ã€‚**

å®Œæ•´å‘å¸ƒè„šæœ¬ä»£ç ï¼š

```bash
#!/bin/bash
# NFS-CacheFS å®Œæ•´å‘å¸ƒè„šæœ¬

set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

print_step() {
    echo -e "${BLUE}[STEP]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# ğŸ¯ æ£€æŸ¥å‚æ•°ï¼ˆæ”¯æŒå‚æ•°è¾“å…¥ç‰ˆæœ¬å·ï¼‰
if [ $# -ne 1 ]; then
    print_error "ç”¨æ³•: $0 <æ–°ç‰ˆæœ¬å·>"
    print_error "ç¤ºä¾‹: $0 1.2.3"
    exit 1
fi

NEW_VERSION="$1"
TODAY=$(date +%Y-%m-%d)

# éªŒè¯ç‰ˆæœ¬å·æ ¼å¼
if ! echo "$NEW_VERSION" | grep -qE '^[0-9]+\.[0-9]+\.[0-9]+$'; then
    print_error "ç‰ˆæœ¬å·æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸º x.y.z æ ¼å¼"
    exit 1
fi

print_step "å¼€å§‹å‘å¸ƒæµç¨‹ v$NEW_VERSION"

# 1. æ£€æŸ¥ç¯å¢ƒï¼ˆå¼ºåˆ¶ Dockerï¼‰
print_step "æ£€æŸ¥ç¯å¢ƒä¾èµ–..."
command -v docker >/dev/null 2>&1 || { print_error "Docker æœªå®‰è£…ï¼ˆå¿…é¡»ï¼‰"; exit 1; }
command -v gh >/dev/null 2>&1 || { print_error "GitHub CLI æœªå®‰è£…"; exit 1; }
command -v jq >/dev/null 2>&1 || { print_error "jq æœªå®‰è£…"; exit 1; }

# æ£€æŸ¥ Git çŠ¶æ€
if [ -n "$(git status --porcelain)" ]; then
    print_error "Git å·¥ä½œç›®å½•ä¸å¹²å‡€ï¼Œè¯·å…ˆæäº¤æˆ–æš‚å­˜æ›´æ”¹"
    exit 1
fi

# 2. ğŸ¯ è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬å·
print_step "è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬å·..."
sed -i "s/^version = \".*\"/version = \"$NEW_VERSION\"/" Cargo.toml
sed -i "s/version-v[0-9]\+\.[0-9]\+\.[0-9]\+/version-v$NEW_VERSION/g" README.md
sed -i "s/download\/v[0-9]\+\.[0-9]\+\.[0-9]\+/download\/v$NEW_VERSION/g" README.md
sed -i "s/nfs-cachefs-v[0-9]\+\.[0-9]\+\.[0-9]\+/nfs-cachefs-v$NEW_VERSION/g" README.md
sed -i "s/## ğŸ‰ æœ€æ–°ç‰ˆæœ¬ v[0-9]\+\.[0-9]\+\.[0-9]\+/## ğŸ‰ æœ€æ–°ç‰ˆæœ¬ v$NEW_VERSION/" README.md
sed -i "s/- å½“å‰ç‰ˆæœ¬: \*\*v[0-9]\+\.[0-9]\+\.[0-9]\+\*\*/- å½“å‰ç‰ˆæœ¬: **v$NEW_VERSION**/" README.md
# æ›´æ–°main.rsä¸­çš„ç‰ˆæœ¬å·
sed -i "s/\.version(\"[0-9]\+\.[0-9]\+\.[0-9]\+\")/\.version(\"$NEW_VERSION\")/g" src/main.rs
sed -i "s/Starting NFS-CacheFS v[0-9]\+\.[0-9]\+\.[0-9]\+/Starting NFS-CacheFS v$NEW_VERSION/g" src/main.rs

# 3. è‡ªåŠ¨æ›´æ–° CHANGELOG
print_step "è‡ªåŠ¨æ›´æ–° CHANGELOG.md..."
# åˆ›å»ºä¸´æ—¶æ–‡ä»¶
cat > /tmp/new_changelog_entry << EOF
## [$NEW_VERSION] - $TODAY

### Added
- é‡æ„æ„å»ºç³»ç»Ÿä¸º Docker æ–¹å¼
- æ·»åŠ å®Œæ•´çš„å‘å¸ƒè‡ªåŠ¨åŒ–æµç¨‹
- æ–°å¢ GitHub Actions è‡ªåŠ¨å‘å¸ƒå·¥ä½œæµ

### Changed
- ç»Ÿä¸€ä½¿ç”¨ Docker æ„å»ºï¼Œç§»é™¤æœ¬åœ°æ„å»ºä¾èµ–
- é‡æ–°ç»„ç»‡ build ç›®å½•ç»“æ„
- æ›´æ–° Makefile æ”¯æŒ Docker æ„å»º

### Fixed
- ä¿®å¤æ„å»ºç¯å¢ƒä¾èµ–é—®é¢˜
- ä¼˜åŒ–å‘å¸ƒæµç¨‹å’Œæ–‡æ¡£

EOF

# åœ¨ CHANGELOG.md ä¸­æ’å…¥æ–°ç‰ˆæœ¬æ¡ç›®
sed -i '/^# Changelog/r /tmp/new_changelog_entry' CHANGELOG.md
rm -f /tmp/new_changelog_entry

print_warning "è¯·æ‰‹åŠ¨ç¼–è¾‘ CHANGELOG.md æ·»åŠ ç‰ˆæœ¬ v$NEW_VERSION çš„å…·ä½“æ›´æ–°å†…å®¹"
print_warning "æŒ‰ Enter é”®ç»§ç»­..."
read -r

# 4. ğŸ³ å¼ºåˆ¶ Docker æ„å»º
print_step "æ‰§è¡Œ Docker æ„å»ºï¼ˆå¼ºåˆ¶ï¼‰..."
make clean
make build

# 5. éªŒè¯æ„å»º
print_step "éªŒè¯æ„å»ºç»“æœ..."
if ! docker images | grep -q nfs-cachefs; then
    print_error "Docker é•œåƒæ„å»ºå¤±è´¥"
    exit 1
fi

if ! ls nfs-cachefs-v*.tar.gz >/dev/null 2>&1; then
    print_error "å‘å¸ƒåŒ…ç”Ÿæˆå¤±è´¥"
    exit 1
fi

# æµ‹è¯•é•œåƒ
make docker-test

# 6. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
print_step "åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾..."
git add Cargo.toml README.md CHANGELOG.md src/main.rs
git commit -m "chore: bump version to v$NEW_VERSION"
git tag -a "v$NEW_VERSION" -m "Release v$NEW_VERSION"

# 7. æ¨é€åˆ°è¿œç¨‹
print_step "æ¨é€åˆ°è¿œç¨‹ä»“åº“..."
git push origin main
git push origin "v$NEW_VERSION"

# 8. åˆ›å»º GitHub Release
print_step "åˆ›å»º GitHub Release..."
RELEASE_NOTES=$(cat << EOF
# NFS-CacheFS v$NEW_VERSION

## ğŸ“¦ å®‰è£…æ–¹æ³•

### é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆæ¨èï¼‰
\`\`\`bash
wget https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/download/v$NEW_VERSION/nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz
tar -xzf nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz
cd nfs-cachefs-v$NEW_VERSION-linux-x86_64
sudo ./install.sh
\`\`\`

## ğŸ” æ ¡éªŒå’Œ
\`\`\`bash
sha256sum -c nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz.sha256
\`\`\`

## ğŸ“‹ æ›´æ–°å†…å®¹
$(sed -n "/## \[$NEW_VERSION\]/,/## \[/p" CHANGELOG.md | head -n -1)

## ğŸ› ï¸ æŠ€æœ¯ä¿¡æ¯
- **æ„å»ºæ–¹å¼**: Docker æ„å»ºï¼ˆrust:1.78-alpineï¼‰
- **ç›®æ ‡å¹³å°**: Linux x86_64
- **é“¾æ¥æ–¹å¼**: é™æ€é“¾æ¥ï¼ˆmusl libcï¼‰
- **é•œåƒå¤§å°**: çº¦ 24MB
- **å…¼å®¹æ€§**: æ‰€æœ‰ Linux å‘è¡Œç‰ˆ

## ğŸ“– æ–‡æ¡£
- [å®‰è£…æŒ‡å—](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')#å¿«é€Ÿå¼€å§‹)
- [å‘å¸ƒæµç¨‹](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/blob/main/docs/RELEASE_PROCESS.md)
- [æ›´æ–°æ—¥å¿—](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/blob/main/CHANGELOG.md)
EOF
)

gh release create "v$NEW_VERSION" \
    --title "NFS-CacheFS v$NEW_VERSION" \
    --notes "$RELEASE_NOTES" \
    nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz \
    nfs-cachefs-v$NEW_VERSION-linux-x86_64.tar.gz.sha256

# 9. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
print_step "æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
rm -f *.tar.gz *.tar.gz.sha256
docker system prune -f
rm -rf nfs-cachefs-v*
rm -f .release-* release-notes-* temp-*

# 10. åˆ›å»º PRï¼ˆå¦‚æœéœ€è¦ï¼‰
CURRENT_BRANCH=$(git branch --show-current)
if [ "$CURRENT_BRANCH" != "main" ]; then
    print_step "åˆ›å»º PR..."
    git push origin "$CURRENT_BRANCH"
    
    gh pr create \
        --title "Release v$NEW_VERSION" \
        --body "ğŸš€ å‘å¸ƒæ–°ç‰ˆæœ¬ v$NEW_VERSION

## ğŸ“‹ å‘å¸ƒæ¸…å•
- [x] æ›´æ–°ç‰ˆæœ¬å· (Cargo.toml, README.md, main.rs)
- [x] æ›´æ–° CHANGELOG.md
- [x] Docker æ„å»ºæˆåŠŸ
- [x] äºŒè¿›åˆ¶æ–‡ä»¶æµ‹è¯•é€šè¿‡
- [x] GitHub Release åˆ›å»ºå®Œæˆ
- [x] ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ

## ğŸ”— ç›¸å…³é“¾æ¥
- [GitHub Release](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/tag/v$NEW_VERSION)
- [ä¸‹è½½é¡µé¢](https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/latest)

## ğŸ§ª æµ‹è¯•ç»“æœ
- âœ… Docker é•œåƒæ„å»ºæˆåŠŸ
- âœ… äºŒè¿›åˆ¶æ–‡ä»¶åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… é™æ€é“¾æ¥éªŒè¯é€šè¿‡
- âœ… æ ¡éªŒå’Œç”Ÿæˆæ­£ç¡®

/cc @maintainers" \
        --assignee @me
    
    echo "ğŸ“ PR åˆ›å»ºæˆåŠŸ: https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/pulls"
else
    echo "ğŸ“Œ å½“å‰åœ¨ main åˆ†æ”¯ï¼Œæ— éœ€åˆ›å»º PR"
fi

print_success "ğŸ‰ å‘å¸ƒæµç¨‹å®Œæˆï¼"
print_success "ğŸ“¦ GitHub Release: https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/tag/v$NEW_VERSION"
print_success "ğŸ”— ä¸‹è½½é¡µé¢: https://github.com/$(gh repo view --json owner,name -q '.owner.login + "/" + .name')/releases/latest"
```

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ„å»ºå¤±è´¥ - æœ¬åœ°æ„å»ºä¸æ”¯æŒ**
```bash
# è§£å†³æ–¹æ¡ˆï¼šå¿…é¡»ä½¿ç”¨ Docker æ„å»º
make clean
make build  # è¿™ä¼šè‡ªåŠ¨ä½¿ç”¨ Docker æ„å»º
```

**Q: ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯**
```bash
# æ­£ç¡®æ ¼å¼
./build/release.sh 1.2.3   # âœ… æ­£ç¡®
./build/release.sh v1.2.3  # âŒ é”™è¯¯
./build/release.sh 1.2     # âŒ é”™è¯¯
```

**Q: GitHub CLI è®¤è¯å¤±è´¥**
```bash
# é‡æ–°ç™»å½•
gh auth logout
gh auth login --web
```

**Q: Docker æ„å»ºå¤±è´¥**
```bash
# æ¸…ç† Docker ç¯å¢ƒ
docker system prune -a -f
docker builder prune -a -f

# é‡æ–°æ„å»º
make build
```

**Q: ç‰ˆæœ¬æ ‡ç­¾å·²å­˜åœ¨**
```bash
# åˆ é™¤æœ¬åœ°æ ‡ç­¾
git tag -d v1.2.3

# åˆ é™¤è¿œç¨‹æ ‡ç­¾
git push origin --delete v1.2.3
```

**Q: GitHub Release åˆ›å»ºå¤±è´¥**
```bash
# æ£€æŸ¥æƒé™
gh auth status

# æ‰‹åŠ¨åˆ›å»º Release
gh release create v1.2.3 \
    --title "NFS-CacheFS v1.2.3" \
    --notes "Release notes here" \
    *.tar.gz*
```

### ğŸ¯ å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] ç¯å¢ƒä¾èµ–å·²å®‰è£…ï¼ˆDocker, GitHub CLI, jqï¼‰
- [ ] Git å·¥ä½œç›®å½•å¹²å‡€
- [ ] ç‰ˆæœ¬å·æ ¼å¼æ­£ç¡®ï¼ˆx.y.zï¼‰
- [ ] ä½¿ç”¨ `./build/release.sh <ç‰ˆæœ¬å·>` è¿›è¡Œå‘å¸ƒ
- [ ] æ‰€æœ‰æ–‡ä»¶ç‰ˆæœ¬å·å·²è‡ªåŠ¨æ›´æ–°
- [ ] CHANGELOG.md å·²æ‰‹åŠ¨ç¼–è¾‘
- [ ] Docker æ„å»ºæˆåŠŸ
- [ ] äºŒè¿›åˆ¶æ–‡ä»¶æµ‹è¯•é€šè¿‡
- [ ] ç‰ˆæœ¬æ ‡ç­¾å·²åˆ›å»º
- [ ] GitHub Release å·²å‘å¸ƒ
- [ ] ä¸´æ—¶æ–‡ä»¶å·²æ¸…ç†
- [ ] PR å·²åˆ›å»ºï¼ˆå¦‚éœ€è¦ï¼‰

### ğŸ“‹ ç‰ˆæœ¬å·æ›´æ–°æ–‡ä»¶æ¸…å•

è‡ªåŠ¨åŒ–è„šæœ¬ä¼šæ›´æ–°ä»¥ä¸‹æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼š

- [x] **Cargo.toml** - é¡¹ç›®ç‰ˆæœ¬å·
- [x] **README.md** - ç‰ˆæœ¬å¾½ç« ã€ä¸‹è½½é“¾æ¥ã€ç‰ˆæœ¬è¯´æ˜
- [x] **src/main.rs** - åº”ç”¨ç¨‹åºç‰ˆæœ¬å·å’Œå¯åŠ¨ä¿¡æ¯
- [x] **CHANGELOG.md** - è‡ªåŠ¨ç”Ÿæˆæ–°ç‰ˆæœ¬æ¡ç›®ï¼ˆéœ€æ‰‹åŠ¨ç¼–è¾‘å†…å®¹ï¼‰

---

*æœ€åæ›´æ–°ï¼š2025å¹´1æœˆ - å¼ºè°ƒ Docker æ„å»ºå’Œå‚æ•°åŒ–ç‰ˆæœ¬å·å‘å¸ƒ* 